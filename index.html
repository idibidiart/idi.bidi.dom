<!DOCTYPE html>
<html>
<head>
  <meta charset='utf-8'>

  <title>idibidiart/idom @ GitHub</title>
 
 <script src='idom.js'></script>

  <!-- github styles -->
  <style type="text/css">
  	
    body {
      margin-top: 1.0em;
      font-family: Helvetica, Arial, FreeSans, san-serif;
    }
    #container {
      margin: 0 auto;
      width: 700px;
    }
    h1 { font-size: 3.8em; color: #8073ab; margin-bottom: 3px; }
    h1 .small { font-size: 0.4em; }
    h1 a { text-decoration: none }
    h2 { font-size: 1.5em; color: #8073ab; }
    h3 { text-align: center; color: #8073ab; }
    a { color: #8073ab; }
    .description { font-size: 1.2em; margin-bottom: 30px; margin-top: 30px; font-style: italic;}
    .download { float: right; }
    pre { padding-left: 15px; word-break: break; font-size: 15px}
    hr { border: 0; width: 80%; border-bottom: 1px solid #aaa}
    .footer { text-align:center; padding-top:30px; font-style: italic; }
  
  </style>
</head>

<body style='color: black; background-color: snow'>
  <a href="https://github.com/idibidiart/idi.bidi.dom">
  	<img style="position: absolute; top: 0; right: 0; border: 0;" src="http://s3.amazonaws.com/github/ribbons/forkme_right_darkpurple_121621.png" alt="Fork me on GitHub" /></a>

  <div id="container">

    <div class="download">
      <a href="http://github.com/idibidiart/idi.bidi.dom/zipball/master">
        <img border="0" width="90" src="http://github.com/images/modules/download/zip.png"></a>
      <a href="http://github.com/idibidiart/idi.bidi.dom/tarball/master">
        <img border="0" width="90" src="http://github.com/images/modules/download/tar.png"></a>
    </div>

    <h1><a href="http://github.com/idibidiart/idi.bidi.dom">idom</a>
      <span class="small">by <a href="https://github.com/idibidiart">idibidiart</a></span></h1>

    <div class="description">
      New Way To Interact With The DOM
    </div>
</div>

<pre>

/*! idi.bidi.dom 
* 
* v0.5
*
* New Way To Interact With The DOM 
*
* Copyright (c) Marc Fawzi 2012
* 
* http://javacrypt.wordpress.com
*
* Apache License 2.0  
* 
* derived from NattyJS v0.08: a BSD licensed precursor by the same author 
*
*/


<br>
<img src= "idom.png";/>
<br>
Example:
<br>
<div style='color: gray'>
&lt;!-- Start of Node -->
&lt;div idom-node-id='teamContainer' style='float: left; width: 200px; height: 400px; padding: 20px; margin: 20px; border-radius: 10px; 
border: none; background-color: gray; color: black; display: none;'>
	
&lt;!-- Start of Node Prototype -->	
&lt;div>
&lt;div style='padding: 5px;'>idom$caption&lt;/div>
&lt;!-- @idom userInfo -->	 
&lt;/div> 
&lt;!-- End of Node Prototype -->
	
&lt;/div>
&lt;!-- End of Node -->

&lt;!-- Start of Node -->
&lt;div idom-node-id='userInfo' style='display: none;'>
	
&lt;!-- Start of Node Prototype -->
&lt;div class='classNameCanBEaVariableToo'>
&lt;table cellspacing="20px">
&lt;tr>
&lt;td>
&lt;div onclick='idom$someHandler' style='background-color: idom$itemColor; border-radius: 5px; padding: 5px'>idom$username&lt;/div>
&lt;/td>
&lt;td>
&lt;div onclick='idom$someHandler' style='background-color: idom$itemColor; border-radius: 5px; padding: 5px'>idom$id&lt;/div>
&lt;/td>
&lt;/tr>
&lt;/table>
&lt;/div>
&lt;!-- End of Node Prototype -->
	
&lt;/div>
&lt;!-- End of Node -->
</div>
</pre>

<div id='mainDiv' style='height: 600px'>
<div>

<p>Click on any user below to see the idom-attached event handler for the target element in action</p>

<button onclick='button1()'>Click to disable event handling on 2nd user in clone 2</button>
<button onclick='button2()'>Click to enable event handling on 2nd user in clone 2</button>
<br><br>
<button onclick='button3()'>Click to delete content of clone 3</button>
<button onclick='button4()'>Click to re-populate clone 3</button>

</div>
	
</div>



<!--************************************************* INTERFACE OBJECT ***********************************************-->
<script type="text/javascript" src="jsonData.js"></script>

<!--************************************************* VIEW OBJECTS ***************************************************-->
<!-- Start of Node -->
<div idom-node-id='teamContainer' style='float: left; width: 200px; height: 400px; padding: 20px; margin: 20px; border-radius: 10px; 
border: none; background-color: gray; color: black; display: none;'>
	
	<!-- Start of Node Prototype -->	
	<div>
		<div style='padding: 5px;'>idom$caption</div>
		<!-- @idom userInfo -->	 
	</div> 
	<!-- End of Node Prototype -->
	
</div>
<!-- End of Node -->

<!-- Start of Node -->
<div idom-node-id='userInfo' style='display: none;'>
	
	<!-- Start of Node Prototype -->
	<div class='classNameCanBEaVariableToo'>
		<table cellspacing="20px">
			<tr>
				<td>
					<div onclick='idom$someHandler' style='background-color: idom$itemColor; border-radius: 5px; padding: 5px'>idom$username</div>
				</td>
				<td>
					<div onclick='idom$someHandler' style='background-color: idom$itemColor; border-radius: 5px; padding: 5px'>idom$id</div>
				</td>
			</tr>
		</table>
	</div>
	<!-- End of Node Prototype -->
	
</div>
<!-- End of Node -->



<script>
/*********************************************** PRESENTER *************************************************************/

//cache DOM elements with idom-node-id (i.e. all node prototypes) and supply values for init() variables (i$var) if any
idom.init();	

for (m = 0; m < jsonData.teams.length; m++) {
		
	//populate the Node Prototype of the Linked Node first  
	//and populate again each time before making a new clone that links it 
	for (n = 0; n < jsonData.teams[m].members.length; n++) {
	
		document.querySelector('[idom-node-id=userInfo]').idom$('clone' + Number(m + 1),
			{
				username: jsonData.teams[m].members[n].username,
				id: jsonData.teams[m].members[n].id,
				// we can have as many event handlers on or within a node but here we're just using the 
				//same one on two elements 
				someHandler: 'idom.eventHandler(event, this, changeColor)' 
				// event handler can be removed by simply setting someHandler to null
			}, 
			{
				mode: 'append',
				instanceId: 'user' + n
			})
	
	}
	
	// perform replace on the host Node (linked node gets re/linked with each idom$() call)
	// and populate again each time before making a new clone of it
	document.querySelector('[idom-node-id=teamContainer]').idom$('clone' + Number(m + 1),
		{
			caption: jsonData.teams[m].caption
		}, 
		{
			mode: 'replace',
			instanceId: 'team' + Number(m + 1)
		})		

	// at this point the teamContainer div is populated with the 'caption' data and the content of the linked userInfo node 
	// so we may now clone it and provide a uid for the clone (e.g. 'clone1')
	var clonedEl = document.querySelector('[idom-node-id=teamContainer]').idom$clone('clone' + Number(m + 1))

	//insert cloned node into body
	document.querySelector('#mainDiv').appendChild(clonedEl);
	
	// normally, we'd delete the contents of the host node (so we're startig with no instances in the next iteration) but 
	// in this case the host node's node prototype instance is being replaced each time (mode: 'replace') 
	// so no need to delete it
	
	// now that we have everything in the cloned node, delete the external linked node's content so we're startig with 
	// no instances in the next iteration)
	document.querySelector('[idom-node-id=userInfo]').idom$delete()

	// now we can display the cloned node and the linked node within it (also cloned) both having been tagged during
	// cloning with the clone uid at end of their idom-node-id's
	idom.forEachExec(document.querySelectorAll("[idom-node-id$='clone" + Number(m + 1) + "']"), "style.display = 'block'")
}

var toggleColor = {};

// the event handler is defined here on each instance of the node prototype of the linked node that's now inside 
// the cloned node, but it can also be defined anywhere within any node (and anywhere within any linked nodes within
// it) 

// About Events:
// If the handler is defined on the node it will only have access to the node id. If it's defined on or in the
// node prototype it will have access to the instance id

// The context of 'this' inside the handler becomes the element the event is defined on (i.e. the cloned node
// or the node prototype instance within it), which is the normal way 'this' is handled in this context

// event handlers that are not defined using element attributes (e.g. onclick, onmouseover, etc) are not handled
// by idom at this time. Finding and cloning all event handlers that are attached via different means, like jQuery, 
// will be supported in the future 

function changeColor(event, nodeId, instanceId, cloneId) {
	
	event.preventDefault();
    
	toggleColor[instanceId] = !toggleColor[instanceId];
	
	if (toggleColor[instanceId]) {
		
		// notice that we're only supplying the new/changed data (the delta not the whole set) for the idom$ variables 
		// in the node prototype. The idom$ variable values are persisted in an internal hashmap per each instance 

		document.querySelector('[idom-node-id="' + nodeId + '"]').idom$(cloneId,
				{
					itemColor: colorSelector(instanceId)
				}, 
				{
					// instanceId in settings is the same as the original populated node 
					// without link/clone references (they're added automatically)
					
				
					instanceId: idom.baseSelector(instanceId), 
					mode: 'replace', 
					targetInstanceId: idom.baseSelector(instanceId)
				})
	} else {
		
		document.querySelector('[idom-node-id="' + nodeId + '"]').idom$(cloneId,
				{
					itemColor: 'transparent'
				}, 
				{
					// instanceId in settings is the same as the original populated node 
					// without link/clone references (they're added automatically)
					
					instanceId: idom.baseSelector(instanceId), 
					mode: 'replace', 
					targetInstanceId: idom.baseSelector(instanceId)
				})
	}

}

function button1() {
	
	// directly accessing the linked node inside the cloned node (the linked can be nested anywhere in the
	// node prototype instance of the original node the clone is copied from)
	document.querySelector('[idom-node-id="userInfo@linked@team2@cloned@clone2"]').idom$('clone2', 
		{
			someHandler: "" //null value removes the handler
		},
		{
			// instanceId in settings is the same as the original populated node 
			// without link/clone references (they're added automatically)
					
			instanceId: "user1",
			mode: "replace",
			targetInstanceId: "user1"
		}
	
	)
}

function button2() {
	
	// directly accessing the linked node inside the cloned node (the linked can be nested anywhere in the
	// node prototype instance of the original node the clone is copied from)
	document.querySelector('[idom-node-id="userInfo@linked@team2@cloned@clone2"]').idom$('clone2', 
		{
			someHandler: "idom.eventHandler(event, this, changeColor)" 
		},
		{
			// instanceId in settings is the same as the original populated node 
			// without link/clone references (they're added automatically)
					
			instanceId: "user1",
			mode: "replace",
			targetInstanceId: "user1"
		}
	
	)
}

function button3() {
	
	// directly accessing the linked node inside the cloned node (the linked can be nested anywhere in the
	// node prototype instance of the original node the clone is copied from)
	document.querySelector('[idom-node-id="teamContainer@cloned@clone3"]').idom$delete()
}

function button4() {
		
	//First, populate the Node Prototype of the Linked Node (the original outside the clone) 
	for (n = 0; n < jsonData.teams[2].members.length; n++) {
	
		document.querySelector('[idom-node-id="userInfo"]').idom$('clone3',
			{
				// data is remembered from the last time this instance (with this clone reference) was populated
				
			}, 
			{
				mode: 'append',
				instanceId: 'user' + n
			})
	
	}
	
	// perform replace on the host Node inside the clone (linked node gets re/linked with each idom$() call)
	// clone reference is automatically added to the Node and the Linked Node and all their instances
	// link reference is automatically added to the Linked Node and all its instances
	document.querySelector('[idom-node-id="teamContainer@cloned@clone3"]').idom$('clone3',
		{
			// data is remembered from the last time this instance (with this clone reference) was populated
				
		}, 
		{
			mode: 'replace',
			instanceId: 'team3'
		})	
	
	// now we can make the linked node inside the clone (and all its instances) visible
	document.querySelector('[idom-node-id="userInfo@linked@team3@cloned@clone3"]').style.display = 'block';
}


function colorSelector(instanceId) {
	
	var item = idom.baseSelector(instanceId)
	
	switch(item) {
		
	case 'user0': 
			
		return 'lightblue';
	
	case 'user1':
		
		return 'orange'
		
	case 'user2':
		
		return 'yellow'
		
	default: return 'white'
	
	}	
}

</script>


<pre>

&lt;script>

/*********************************************** SOURCE FOR TEST CASE ************************************************/

//cache DOM elements with idom-node-id (i.e. all node prototypes) and supply values for init() variables (i$var) if any
idom.init();	

for (m = 0; m &lt; jsonData.teams.length; m++) {
		
	//populate the Node Prototype of the Linked Node first  
	//and populate again each time before making a new clone that links it 
	for (n = 0; n &lt; jsonData.teams[m].members.length; n++) {
	
		document.querySelector('[idom-node-id=userInfo]').idom$('clone' + Number(m + 1),
			{
				username: jsonData.teams[m].members[n].username,
				id: jsonData.teams[m].members[n].id,
				// we can have as many event handlers on or within a node but here we're just using the 
				//same one on two elements 
				someHandler: 'idom.eventHandler(event, this, changeColor)' 
				// event handler can be removed by simply setting someHandler to null
			}, 
			{
				mode: 'append',
				instanceId: 'user' + n
			})
	
	}
	
	// perform replace on the host Node (linked node gets re/linked with each idom$() call)
	// and populate again each time before making a new clone of it
	document.querySelector('[idom-node-id=teamContainer]').idom$('clone' + Number(m + 1),
		{
			caption: jsonData.teams[m].caption
		}, 
		{
			mode: 'replace',
			instanceId: 'team' + Number(m + 1)
		})		

	// at this point the teamContainer div is populated with the 'caption' data and the content of the linked userInfo node 
	// so we may now clone it and provide a uid for the clone (e.g. 'clone1')
	var clonedEl = document.querySelector('[idom-node-id=teamContainer]').idom$clone('clone' + Number(m + 1))

	//insert cloned node into body
	document.querySelector('#mainDiv').appendChild(clonedEl);
	
	// normally, we'd delete the contents of the host node (so we're startig with no instances in the next iteration) but 
	// in this case the host node's node prototype instance is being replaced each time (mode: 'replace') 
	// so no need to delete it
	
	// now that we have everything in the cloned node, delete the external linked node's content so we're startig with 
	// no instances in the next iteration)
	document.querySelector('[idom-node-id=userInfo]').idom$delete()

	// now we can display the cloned node and the linked node within it (also cloned) both having been tagged during
	// cloning with the clone uid at end of their idom-node-id's
	idom.forEachExec(document.querySelectorAll("[idom-node-id$='clone" + Number(m + 1) + "']"), "style.display = 'block'")
}

var toggleColor = {};

// the event handler is defined here on each instance of the node prototype of the linked node that's now inside 
// the cloned node, but it can also be defined anywhere within any node (and anywhere within any linked nodes within
// it) 

// About Events:
// If the handler is defined on the node it will only have access to the node id. If it's defined on or in the
// node prototype it will have access to the instance id

// The context of 'this' inside the handler becomes the element the event is defined on (i.e. the cloned node
// or the node prototype instance within it), which is the normal way 'this' is handled in this context

// event handlers that are not defined using element attributes (e.g. onclick, onmouseover, etc) are not handled
// by idom at this time. Finding and cloning all event handlers that are attached via different means, like jQuery, 
// will be supported in the future 

function changeColor(event, nodeId, instanceId, cloneId) {
	
	event.preventDefault();
    
	toggleColor[instanceId] = !toggleColor[instanceId];
	
	if (toggleColor[instanceId]) {
		
		// notice that we're only supplying the new/changed data (the delta not the whole set) for the idom$ variables 
		// in the node prototype. The idom$ variable values are persisted in an internal hashmap per each instance 

		document.querySelector('[idom-node-id="' + nodeId + '"]').idom$(cloneId,
				{
					itemColor: colorSelector(instanceId)
				}, 
				{
					// instanceId in settings is the same as the original populated node 
					// without link/clone references (they're added automatically)
					
				
					instanceId: idom.baseSelector(instanceId), 
					mode: 'replace', 
					targetInstanceId: idom.baseSelector(instanceId)
				})
	} else {
		
		document.querySelector('[idom-node-id="' + nodeId + '"]').idom$(cloneId,
				{
					itemColor: 'transparent'
				}, 
				{
					// instanceId in settings is the same as the original populated node 
					// without link/clone references (they're added automatically)
					
					instanceId: idom.baseSelector(instanceId), 
					mode: 'replace', 
					targetInstanceId: idom.baseSelector(instanceId)
				})
	}

}

function button1() {
	
	// directly accessing the linked node inside the cloned node (the linked can be nested anywhere in the
	// node prototype instance of the original node the clone is copied from)
	document.querySelector('[idom-node-id="userInfo@linked@team2@cloned@clone2"]').idom$('clone2', 
		{
			someHandler: "" //null value removes the handler
		},
		{
			// instanceId in settings is the same as the original populated node 
			// without link/clone references (they're added automatically)
					
			instanceId: "user1",
			mode: "replace",
			targetInstanceId: "user1"
		}
	
	)
}

function button2() {
	
	// directly accessing the linked node inside the cloned node (the linked can be nested anywhere in the
	// node prototype instance of the original node the clone is copied from)
	document.querySelector('[idom-node-id="userInfo@linked@team2@cloned@clone2"]').idom$('clone2', 
		{
			someHandler: "idom.eventHandler(event, this, changeColor)" 
		},
		{
			// instanceId in settings is the same as the original populated node 
			// without link/clone references (they're added automatically)
					
			instanceId: "user1",
			mode: "replace",
			targetInstanceId: "user1"
		}
	
	)
}

function button3() {
	
	// directly accessing the linked node inside the cloned node (the linked can be nested anywhere in the
	// node prototype instance of the original node the clone is copied from)
	document.querySelector('[idom-node-id="teamContainer@cloned@clone3"]').idom$delete()
}

function button4() {
		
	//First, populate the Node Prototype of the Linked Node (the original outside the clone) 
	for (n = 0; n &lt; jsonData.teams[2].members.length; n++) {
	
		document.querySelector('[idom-node-id="userInfo"]').idom$('clone3',
			{
				// data is remembered from the last time this instance (with this clone reference) was populated
				
			}, 
			{
				mode: 'append',
				instanceId: 'user' + n
			})
	
	}
	
	// perform replace on the host Node inside the clone (linked node gets re/linked with each idom$() call)
	// clone reference is automatically added to the Node and the Linked Node and all their instances
	// link reference is automatically added to the Linked Node and all its instances
	document.querySelector('[idom-node-id="teamContainer@cloned@clone3"]').idom$('clone3',
		{
			// data is remembered from the last time this instance (with this clone reference) was populated
				
		}, 
		{
			mode: 'replace',
			instanceId: 'team3'
		})	
	
	// now we can make the linked node inside the clone (and all its instances) visible
	document.querySelector('[idom-node-id="userInfo@linked@team3@cloned@clone3"]').style.display = 'block';
}


function colorSelector(instanceId) {
	
	var item = idom.baseSelector(instanceId)
	
	switch(item) {
		
	case 'user0': 
			
		return 'lightblue';
	
	case 'user1':
		
		return 'orange'
		
	case 'user2':
		
		return 'yellow'
		
	default: return 'white'
	
	}	
}

/******************************************************************************
 * 
 * README:
 * 
 * This version works in Gecko and Webkit, not tested on IE
 *
 * idi.bidi.dom - Anti-Templating Framework For Javascript -- offers a radically
 * different way for interfacting with the DOM. In abstract terms, it takes the DOM 
 * and adds variables, variable memoization, encapsulation, multiple-inheritance and 
 * type polymorphism (with the Node Prototype as the user defined type) In logical 
 * terms, it offers a list-based API for creating, updating, and deleting predetermined 
 * DOM structures with the ability to dynamically nest and directly access other 
 * predetermined DOM structures at any depth within them.
 *
 * Why use it?
 * 
 * idi.bidi.dom reduces HTML on a page to a minimum and places a simple and consistent
 * JSON API between presentation logic and the DOM
 * 
 * How does it work?
 * 
 * idi.bidi.dom allows the DOM to be decomposed into Nodes each having a 
 * Node Prototype of which instances (copies, with the same or entirely different data) 
 * may be created, populated with JSON data, inserted into --and deleted from-- the Node 
 * (with the ability to target specific, previously inserted instances of the Node 
 * Prototype or all such instances), and where each Node can be linked by reference into 
 * any number of other Nodes.
 * 
 * Additionally, idi.bidi.dom allows the cloning of each Node and all the populated
 * instances within it (including any Linked Nodes inserted into the host's Node Prototype 
 * and their populated instances) This means that we may re-use the same Node to create 
 * any number of differently populated Nodes.  
 *
 * Unlike other template-less DOM rendering frameworks, idi.bidi.dom does not attempt 
 * to take the place of Javascript itself nor does it add its own boilerplate; it 
 * simply gives Javascript more power by leveraging a simple and consistent interface
 * to the DOM. 
 *
 * Usage:
 *
 * format: document.querySelector('#someNode').idom$(cloneId, data [, settings])
 * 
 * output: creates a new instance of Node Prototype using 'data' (json) to populate the 
 * special variables in the Node, then append/prepend to (or replace) existing 
 * instance(s) of Node Prototype in the Node
 *
 * cloneId: unique id for the future or current clone the data is intended for  
 *
 * data: {key: value, key: value, key: value, etc} 
 * where the key must match the variable name in the data minus the idom$ prefix
 *
 * settings: {mode: 'replace'|'append'|'prepend', targetInstanceId: value, instanceId: 
 * value}
 *
 * if there no populated instances of Node Prototype then append/prepend/replace 
 * will create a new instance of the Node Prototype (so if a targetInstanceId is supplied 
 * in this case it will throw an error, so call .$isPopulated() first to be sure before 
 * invoking this method with targetInstanceId, unless you know the node is populated)
 *
 * targetInstanceId: (1) idom-instance-id value for the instance of the Node Prototype to 
 * insert _at_ when in append and prepend modes. If null, append/prepend at last/first 
 * previously populated instance of the Node Prototype, or to start of the list if none 
 * were previously populated.
 *
 * targetInstanceId: (2) dom-instance-id value for instance(s) of the Node Protoype to 
 * replace when in replace mode. If null, replace all instances.
 *
 * instanceId: idom-instance-id value for instance of Prototype Node being populated. 
 *
 *********************************************************************************
 * 
 * Other available are methods are 
 *
 * .idom$delete([settings]) which can delete certain populated instances of the Node 
 * Prototype or all populated instances 
 *
 * .idom$isPopulated() may be queried before specifying targetInstanceId  
 * to verify existence of populated instance(s) of Node Prototype (the targets) 
 * 
 * idom$clone may be used to clone an entire node (including any linked nodes) after it's 
 * been populated)
 *
 **********************************************************************************
 *
 * About Events:
 * If the handler is defined on the node it will only have access to the node id. If it's 
 * defined on or in the node prototype it will have access to the instance id
 *
 * The context of 'this' inside the handler becomes the element the event is defined on 
 * (i.e. the cloned node or the node prototype instance within it), which is the normal 
 * way 'this' is handled in this context
 *
 * event handlers that are not defined using element attributes (e.g. onclick, onmouseover, 
 * etc) are not handled by idom at this time. Finding and cloning all event handlers that 
 * are attached via different means, like jQuery, will be supported in the future 
 * 
 *********************************************************************************/
	


&lt;/script>
	
</pre>
</body>
</html>		


