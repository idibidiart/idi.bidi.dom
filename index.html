<!DOCTYPE html>
<html>
<head>
  <meta charset='utf-8'>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>idibidiart/idom @ GitHub</title>
 
  <script src='idom.js'></script>

  <!-- github styles -->
 
  <style>
	body{
	position: absolute;
	width: 100%;
	padding: 0px;
	margin: 0px;
	font-family: Helvetica, Arial, FreeSans, san-serif;
	}
	
	#banner{
	position: relative;

	height: 149px;
	width: 149px;
	overflow:hidden;
	padding: 0px;
	float: right;
	margin-right: 0px;
	}
	
	#banner a{
	
	display: block;
	width: 190px;
	font-size: 14px;
	font-family: Frutiger, "Frutiger Linotype", Univers, Calibri, "Gill Sans", "Gill Sans MT",
	"Myriad Pro", Myriad, "DejaVu Sans Condensed", "Liberation Sans", "Nimbus Sans L", Tahoma,
	Geneva, "Helvetica Neue", Helvetica, Arial, sans serif;
	background-color: #333;
	color: #FFF;
	word-spacing: 2px;
	text-decoration: none;
	padding: 5px 15px 5px 25px;
	
	position:relative;
	left: 20px;
	top: -37px;
	text-align: center;
	
	-moz-transform-origin: 0 0 ;
	-moz-transform:rotate(45deg);
	-moz-box-shadow: 1px 1px 5px 1px #666;
	
	-webkit-transform-origin: 0 0 ;
	-webkit-transform:rotate(45deg);
	-webkit-box-shadow: 1px 1px 5px 1px #666;
	
	-ms-transform-origin: 0 0 ;
	-ms-transform:rotate(45deg);
	-ms-box-shadow: 1px 1px 5px 1px #666;
	
	transform-origin: 0 0 ;
	transform:rotate(45deg);
	box-shadow: 1px 1px 5px 1px #666;
	
	background-image: linear-gradient(bottom, #000000 3%, #666666 5%, #000000 7%, #000000 93%, #666666 95%, #000000 97%);
	background-image: -o-linear-gradient(bottom, #000000 3%, #666666 5%, #000000 7%, #000000 93%, #666666 95%, #000000 97%);
	background-image: -moz-linear-gradient(bottom, #000000 3%, #666666 5%, #000000 7%, #000000 93%, #666666 95%, #000000 97%);
	background-image: -webkit-linear-gradient(bottom, #000000 3%, #666666 5%, #000000 7%, #000000 93%, #666666 95%, #000000 97%);
	background-image: -ms-linear-gradient(bottom, #000000 3%, #666666 5%, #000000 7%, #000000 93%, #666666 95%, #000000 97%);
	
	background-image: -webkit-gradient(
	linear,
	left bottom,
	left top,
	color-stop(0.03, #000000),
	color-stop(0.05, #666666),
	color-stop(0.07, #000000),
	color-stop(0.93, #000000),
	color-stop(0.95, #666666),
	color-stop(0.97, #000000)
	);
	
	}	
    
    #container {
      margin: 0 auto;
      width: 700px;
    }
    h1 { font-size: 3.8em; color: #8073ab; margin-bottom: 3px; }
    h1 .small { font-size: 0.4em; }
    h1 a { text-decoration: none }
    h2 { font-size: 1.5em; color: #8073ab; }
    h3 { text-align: center; color: #8073ab; }
    a { color: #8073ab; }
    .description { font-size: 1.2em; margin-bottom: 30px; margin-top: 30px; font-style: italic;}
    .download { float: right; }
    pre { padding-left: 15px; word-break: break; font-size: 15px}
    hr { border: 0; width: 80%; border-bottom: 1px solid #aaa}
    .footer { text-align:center; padding-top:30px; font-style: italic; }
  
  </style>
  
  
</head>

<body style='color: black; background-color: snow'>
	<div id="banner"><a href="http://github.com/idibidiart/idi.bidi.dom">Spoon me on GitHub</a></div>
  
  <div id="container">

    <div class="download">
      <a href="http://github.com/idibidiart/idi.bidi.dom/zipball/master">
        <img border="0" width="90" src="http://github.com/images/modules/download/zip.png"></a>
      <a href="http://github.com/idibidiart/idi.bidi.dom/tarball/master">
        <img border="0" width="90" src="http://github.com/images/modules/download/tar.png"></a>
    </div>

    <h1><a href="http://github.com/idibidiart/idi.bidi.dom">idom</a>
      <span class="small">by <a href="https://github.com/idibidiart">idibidiart</a></span></h1>

    <div class="description">
      New Way To Interact With The DOM
    </div>
</div>

<pre>

/*! idi.bidi.dom 
* 
* v0.13
*
* A New Way To Interact With The DOM 
*
* ****************************************************************************
* 
* Copyright (c) Marc Fawzi 2012-
* 
* http://javacrypt.wordpress.com
* 
* Apache License 2.0 
* 
* 
* *****************************************************************************
* 
* This software is derived in certain parts from NattyJS, an early work by the 
* same author "Copyright (c) Marc Fawzi, NiNu, Inc. 2011-2012" released under 
* the BSD License.  
*
*/
 
<br>
<img src= "idom.png";/>
<br>
/* 
 * idi.bidi.dom - Anti-Templating Framework For Javascript -- offers a radically
 * different way for interfating with the DOM. In abstract terms, it takes the DOM 
 * and adds variables, variable memoization, encapsulation, multiple-inheritance and 
 * type polymorphism (with the Node Prototype as the user defined type) In logical 
 * terms, it offers a list-based API for creating, populating, and de-populating 
 * predetermined DOM structures with the ability to link, directly access, populate
 * and de-populate other predetermined DOM structures at any depth within them, thus 
 * giving us a simple and consistent alternative to the DOM's native API while allowing 
 * us to reduce the amount of HTML as well as separate the HTML from the presentation 
 * logic.
 *
 */
<br>
Example:
<br>
<div style='color: gray'>

&lt;!--************************************************* VIEW OBJECTS ***************************************************-->

&lt;div style='display: none'>
&lt;!-- Start of Node -->
&lt;div idom-node-id='teamInfo' class='idom$teamsClass' style='background-color: idom$bgColorTeams; idom$cssTransform'>
	
	&lt;!-- Start of Node Prototype -->	
	&lt;div class='idom$teamsProtoClass' style='background-color: idom$instanceColorTeams'>
		&lt;div style='padding: 5px;'>idom$caption&lt;/div>
		
		&lt;!-- @idom userInfo -->
				 
	&lt;/div> 
	&lt;!-- End of Node Prototype -->
	
&lt;/div>
&lt;!-- End of Node -->

&lt;!-- Start of Node -->
&lt;div idom-node-id='userInfo' class='idom$usersClass' style='background-color: idom$bgColorUsers'>
	
	&lt;!-- Start of Node Prototype -->
	&lt;div class='idom$usersProtoClass' style='border: idom$borderStyle;'> 
		
		&lt;div onclick='idom$someHandler'>user: idom$username&nbsp;&nbsp;&nbsp;id: idom$id&lt;/div>
		
		&lt;div class='idom$usersExtendedClass' style='background-color: idom$bgColorUsersExtended; display: idom$displayStatus'> 
		
			&lt;div>last name: idom$lastName&lt;br>work: idom$work&lt;/div>
				
		&lt;/div>
				
	&lt;/div>
	&lt;!-- End of Node Prototype -->
	
&lt;/div>
&lt;!-- End of Node -->

&lt;/div>

</pre>

<div id='mainDiv' style='height: 600px; margin-left: 15px;'>
<div>

<p style='font-size: 24px'>Click on any user below to see the event handler for the target element in action</p>

<button onclick='button1()'>Click to disable event handling on 2nd user in clone 2</button>
<button onclick='button2()'>Click to enable event handling on 2nd user in clone 2</button>
<br><br>
<button onclick='button3()'>dePopulate() clone 3</button>
<button onclick='button4()'>Repopulate clone 3</button>
<button onclick='button5()'>CSS Scale clone 4 (webkit and mozilla only)</button>
<button onclick='button6()'>CSS reScale clone 4 </button>

<br>
<br>
Randomly colored
<br>
<br>
<br<br>

</div>
	
</div>


<!--************************************************* INTERFACE OBJECT ***********************************************-->
<script type="text/javascript" src="jsonData.js"></script>

<!--************************************************* VIEW OBJECTS ***************************************************-->
<style>
.teams1 {
	float: left; 
	width: auto; 
	height: auto;
	margin-left: 0px;
	margin-top: 0px;
	padding: 0px;
	border-radius: 5px;
}
.teams2 {
	float: left; 
	width: auto; 
	height: auto;
	margin-left: 20px;
	margin-top: 15px;
	padding: 0px;
	border-radius: 5px;
	
}
.teams3 {
	float: left; 
	width: auto; 
	height: auto;
	margin-left: 20px;
	margin-top: 30px;
	padding: 0px;
	border-radius: 5px;
}
.teams4 {
	float: left; 
	width: auto; 
	height: auto;
	margin-left: 20px;
	margin-top: 45px;
	padding: 0px;
	border-radius: 5px;
}

.teamsProto {
	
	padding: 20px; 
	border-radius: 10px;
	margin: 10px;
	height: 390px; 
	width: 60%;
}

.users {
	border-radius: 10px;
	height: 300px;
	width: 240px;
	padding: 10px;
}

.usersProto {
	
	box-sizing: border-box ; 
	margin: 2px; 
	border-radius: 5px;
	padding: 5px;
	padding-top: 15px;'
}


.usersExtended {
	
width: 300px;
height: 50px;
padding: 5px;
margin-left: 20px;
border-radius: 5px;
position: absolute;

}



</style>

<div style='display: none'>
<!-- Start of Node -->
<div idom-node-id='teamInfo' class='idom$teamsClass' style='background-color: idom$bgColorTeams; idom$cssTransform'>
	
	<!-- Start of Node Prototype -->	
	<div class='idom$teamsProtoClass' style='background-color: idom$instanceColorTeams;'>
		<div style='padding: 5px;'>idom$caption</div>
		
		<!-- @idom userInfo -->
				 
	</div> 
	<!-- End of Node Prototype -->
	
</div>
<!-- End of Node -->

<!-- Start of Node -->
<div idom-node-id='userInfo' class='idom$usersClass' style='background-color: idom$bgColorUsers'>
	
	<!-- Start of Node Prototype -->
	<div class='idom$usersProtoClass' style='border: idom$borderStyle;'> 
		
		<div onclick='idom$someHandler'>user: idom$username&nbsp;&nbsp;&nbsp;id: idom$id</div>
		
		<div class='idom$usersExtendedClass' style='background-color: idom$bgColorUsersExtended; display: idom$displayStatus'> 
		
			<div>last name: idom$lastName<br>work: idom$work</div>
				
		</div>
				
	</div>
	<!-- End of Node Prototype -->
	
</div>
<!-- End of Node -->

</div>

<br>
<div style='width: 1280px; overflow: hidden'>
<pre>


</pre>	
</div>

<script>
/*********************************************** PRESENTER *************************************************************/

/*************************** ALL SELECTOR DRIVEN LOGIC IS CONTAINED WITHIN THE PRESENTER ***********************************/

//cache DOM elements with idom-node-id (i.e. all node prototypes) 
idom.cache();	

(function() {
	
	for (m = 0; m < jsonData.teams.length; m++) {
		
	//populate the Node Prototype of the Linked Node before the Host Node 
	 
	for (n = 0; n < jsonData.teams[m].members.length; n++) {
	
		document.querySelector('[idom-node-id=userInfo]').idom$(
			{
				usersClass: 'users',
				usersProtoClass: 'usersProto',
				usersExtendedClass: 'usersExtended' ,
				borderStyle: 'none',
				displayStatus: 'none',
				bgColorUsers: rndColor(),
				bgColorUsersExtended: rndColor(),
				username: jsonData.teams[m].members[n].username,
				id: jsonData.teams[m].members[n].id,
				lastName: jsonData.teams[m].members[n].otherData.lastName,
				work: jsonData.teams[m].members[n].otherData.work,
				// we can have as many event handlers on or within a node but here we're just using the 
				// same one here, on user's first name and id 
				someHandler: 'idom.eventHandler(event, this, changeInstance)' 
				// event handler can be removed by simply setting someHandler to null
			}, 
			{
				forClone: 'clone' + Number(m + 1),
				// default mode is replace...
				mode: 'after',
				instanceName: 'user' + n
			})
		
	
	}
	
	// perform replace on the Host Node (linked node gets re/linked with each idom$() call)
	// and populate again each time before making a new clone of it

	document.querySelector('[idom-node-id=teamInfo]').idom$(
		{
			teamsClass: 'teams' + Number(m + 1),
			teamsProtoClass: 'teamsProto',
			bgColorTeams: rndColor(),
			caption: jsonData.teams[m].caption,
			instanceColorTeams: rndColor() 
		}, 
		{	
			forClone: 'clone' + Number(m + 1),
			instanceName: 'teamInfo' + Number(m + 1)
		})		

	// at this point the teamInfo div is populated with the idom$ data and the content of the linked userInfo node 
	// so we may now clone it and provide a uid for the clone (e.g. 'clone1')
	var clonedEl = document.querySelector('[idom-node-id=teamInfo]').idom$clone('clone' + Number(m + 1))

	//insert cloned node into body
	document.querySelector('#mainDiv').appendChild(clonedEl);
	
	// dePopulate() the linked node so we can restart with fresh node 
	document.querySelector('[idom-node-id=userInfo]').idom$dePopulate()
		
	// dePopulate() the host node (so we may start with no instances in the next iteration
	document.querySelector('[idom-node-id=teamInfo]').idom$dePopulate()
	
	}

}())

var toggle = {};

var Instance = {};

// the event handler is defined here on each instance of the linked node that's now inside 
// the cloned node, but it can also be defined anywhere within any node (and anywhere within any linked nodes within
// it) 

// About Events:
// If a handler is defined on the node it will only have access to the node id. If it's defined on or in the
// node prototype it will have access to the instance id

// The context of 'this' inside the handler is the element the event is defined on 

// event handlers that are not defined using inline event handlers (like onclick, onmouseover, etc) are not handled by 
// idom at this time. Finding and cloning all event handlers that are attached via different means, like jQuery, 
// will be supported in the future 

function changeInstance(event, nodeId, instanceName, cloneId) {
	
	// normally, a unique key is the combination of nodeId + instanceName + cloneId 
	// which assumes cloneId is globally unique (user enforced), node is unique within 
	// the clone (framework enforced) and instanceName is unique within the node (user enforced)
	// but in this case the nodeId contains the cloneId so we're safe...
	
	if (Instance[nodeId]) {
		
		document.querySelector('[idom-node-id="' + nodeId + '"]').idom$(
				{
					borderStyle: 'none',
					displayStatus: 'none'
				}, 
				{
					
					// when operating on a clone, we discard the forClone argument
					
					
				    // instanceName in settings is the same as the original populated node 
					// without link/clone references (they're added automatically)
					instanceName: idom.baseSelector(Instance[nodeId]),
					// target instance id (for instance to be replaced) 
					targetInstanceName: idom.baseSelector(Instance[nodeId])
				})
				
				toggle[Instance[nodeId]] = !toggle[Instance[nodeId]];	
				
	} 
	
	Instance[nodeId] = instanceName;
	
	toggle[Instance[nodeId]] = !toggle[Instance[nodeId]];
	
	
	if (toggle[Instance[nodeId]]) {
		
		// notice that we're only supplying the new/changed data (the delta not the whole set) for the idom$ variables 
		// in the node prototype. The idom$ variable values are persisted for each node (shared among original, linked 
		// and cloned versions of the populated node) with the key being a combination of the base node 
		// id, instance id (without the link/clone reference) and clone id 
		
		// directly accessing the linked node inside the cloned node (the linked can be nested anywhere in the
		// node prototype of the original node the clone is copied from)
		// when operating on a clone, we discard the forClone argument
		
		document.querySelector('[idom-node-id="' + nodeId + '"]').idom$(
				{
					borderStyle: borderSelector(instanceName),
					displayStatus: 'block'
				}, 
				{
					// when operating on a clone, we discard the forClone argument
					
				    // instanceName in settings is the same as the original populated node 
					// without link/clone references (they're added automatically)
					instanceName: idom.baseSelector(instanceName),
					// target instance id (for instance to be replaced) 
					targetInstanceName: idom.baseSelector(instanceName)
				})
	} else {
		
		document.querySelector('[idom-node-id="' + nodeId + '"]').idom$(
				{
					borderStyle: 'none',
					displayStatus: 'none'
				}, 
				{
					// when operating on a clone, we discard the forClone argument
					
				    // instanceName in settings is the same as the original populated node 
					// without link/clone references (they're added automatically)
					instanceName: idom.baseSelector(instanceName),
					// target instance id (for instance to be replaced) 
					targetInstanceName: idom.baseSelector(instanceName)
				})
	}
}

function button1() {
	
	// notice that we're only supplying the new/changed data (the delta not the whole set) for the idom$ variables 
	// in the node prototype. The idom$ variable values are persisted for each node (shared among original, linked 
	// and cloned versions of the populated node) with the key being a combination of the base node 
	// id, instance id (without the link/clone reference) and clone id 	
	
	// directly accessing the linked node inside the cloned node (the linked can be nested anywhere in the
	// node prototype of the original node the clone is copied from)
	// when operating on a clone, we discard the forClone argument
	
	document.querySelector('[idom-node-id="userInfo@clone@clone2"]').idom$( 
		{
			someHandler: "" //null value removes the handler
		},
		{
			// when operating on a clone, we discard the forClone argument
					
		    // instanceName in settings is the same as the original populated node 
			// without link/clone references (they're added automatically)		
			instanceName: "user1",
			targetInstanceName: "user1"
		}
	
	)
}

function button2() {
	
	// notice that we're only supplying the new/changed data (the delta not the whole set) for the idom$ variables 
	// in the node prototype. The idom$ variable values are persisted for each node (shared among original, linked 
	// and cloned versions of the populated node) with the key being a combination of the base node 
	// id, instance id (without the link/clone reference) and clone id 
	
	// directly accessing the linked node inside the cloned node (the linked can be nested anywhere in the
	// node prototype of the original node the clone is copied from)
	// when operating on a clone, we discard the forClone argument
	
	document.querySelector('[idom-node-id="userInfo@clone@clone2"]').idom$( 
		{
			someHandler: "idom.eventHandler(event, this, changeInstance)" 
		},
		{
			// when operating on a clone, we discard the forClone argument
					
			// instanceName in settings is the same as the original populated node 
			// without link/clone references (they're added automatically)instanceName: "user1"
			instanceName: "user1",
			targetInstanceName: "user1"
		}
	
	)
}

function button3() {
	
	// notice that we're only supplying the new/changed data (the delta not the whole set) for the idom$ variables 
	// in the node prototype. The idom$ variable values are persisted for each node (shared among original, linked 
	// and cloned versions of the populated node) with the key being a combination of the base node 
	// id, instance id (without the link/clone reference) and clone id 
	
	// delete content of the cloned node (including content of the cloned linked node)
	document.querySelector('[idom-node-id="teamInfo@clone@clone3"]').idom$dePopulate()

}

function button4() {
	
	// delete content of the original Linked Node (outside the clone) 
	if (document.querySelector('[idom-node-id="userInfo"]').idom$isPopulated()) 
		document.querySelector('[idom-node-id="userInfo"]').idom$dePopulate()
		
	//Populate the Node Prototype of the original Linked Node  
	
	// notice that we're only supplying the new/changed data (the delta not the whole set) for the idom$ variables 
	// in the node prototype. The idom$ variable values are persisted for each node (shared among original, linked 
	// and cloned versions of the populated node) with the key being a combination of the base node 
	// id, instance id (without the link/clone reference) and clone id 
	
	for (n = 0; n < jsonData.teams[2].members.length; n++) {
	
		document.querySelector('[idom-node-id="userInfo"]').idom$(
			{
				// data is remembered from the last time this instance (with this clone reference) was populated
				
			}, 
			{
				forClone: 'clone3',
				// default mode is replace...
				mode: 'after',
				instanceName: 'user' + n
			})
	
	}
	
	// Perform replace on the host Node inside the clone (linked node gets re/linked with each idom$() call)
	
	// notice that we're only supplying the new/changed data (the delta not the whole set) for the idom$ variables 
	// in the node prototype. The idom$ variable values are persisted for each node (shared among original, linked 
	// and cloned versions of the populated node) with the key being a combination of the base node 
	// id, instance id (without the link/clone reference) and clone id 

	// Since we're doing a replace, no need to delete content with every invocation 
	// When operating on a clone, we discard the forClone argument
	
	document.querySelector('[idom-node-id="teamInfo@clone@clone3"]').idom$(
		{
			// data is remembered from the last time this instance (with this clone reference) was populated
				
		}, 
		{   
			// when operating on a clone, we discard the forClone argument
					
		    // instanceName in settings is the same as the original populated node 
		    // without link/clone references (they're added automatically)
			instanceName: 'teamInfo3'
		})	
}

function button5() {
	
		document.querySelector('[idom-node-id="teamInfo@clone@clone4"]').idom$(
			{
			 
			 // all other data is remembered for this instance and this clone
			  cssTransform: '-webkit-transform: scale(0.5) ' + 
			  				'skew(-20deg, 20deg); ' + 
			  				'-moz-transform: scale(0.5) ' +
			  				'skew(-20deg, 20deg) ; '
				
			}, 
			{
				
			// when operating on a clone, we discard the forClone argument
			// no instanceName needed since in this mode we're only populating the node's class/stle attribute
				mode: 'node'
			}
			
		)
}

function button6() {
	
	document.querySelector('[idom-node-id="teamInfo@clone@clone4"]').idom$(
			{
			 
			 // all other data is remembered for this instance and this clone
			  cssTransform: '-webkit-transform: scale(1) ' + 
			  				'skew(0deg, 0deg); ' + 
			  				'-moz-transform: scale(1) ' +
			  				'skew(0deg, 0deg); '
				
			}, 
			{
				// when operating on a clone, we discard the forClone argument
				// no instanceName needed since in this mode we're only populating the node's class/stle attribute
				mode: 'node'
			}
			
		)
}

function borderSelector(instanceName) {
	
	var item = idom.baseSelector(instanceName)
	
	switch(item) {
		
		case 'user0':		
			return '1px dashed white';
		
		case 'user1':
			return '1px dotted white'
			
		case 'user2':
			return '1px solid white'
			
		default: 
			return '1px solid white'
	}	
}

function rndColor() {
    
    return (function(h){return '#000000'.substr(0,7-h.length)+h}) ((~~(Math.random()*(1<<24))).toString(16));
}

</script>


<pre>
	
/******************************************************************************
 * 
 * README:
 * 
 * This version works in Gecko and Webkit, not tested on IE
 *
 * idi.bidi.dom - Anti-Templating Framework For Javascript -- offers a radically
 * different way for interacting with the DOM. In abstract terms, it takes the DOM 
 * and adds variables, variable memoization, encapsulation, multiple-inheritance and 
 * type polymorphism (with the Node Prototype as the user defined type) In logical 
 * terms, it offers a list-based API for creating, populating, and de-populating 
 * predetermined DOM structures with the ability to link, directly access, populate
 * and de-populate other predetermined DOM structures at any depth within them, thus 
 * giving us a simple and consistent alternative to the DOM's native API while allowing 
 * us to reduce the amount of HTML as well as separate the HTML from the presentation 
 * logic.
 *  
 * Why use it?
 * 
 * idi.bidi.dom reduces HTML on a page to a minimum and places a simple and consistent
 * JSON API between presentation logic and the DOM
 * 
 * How does it work?
 * 
 * idi.bidi.dom allows the DOM to be decomposed into Nodes each having a Node Prototype 
 * with data-injected variables in their markup. Multiple instances of each Node (i.e. 
 * data populated versions, each with its own persisted data) may be created, populated 
 * with data, and inserted into --and deleted from-- the Node (with the ability to target 
 * specific, previously inserted instances of the Node or all such instances). Each Node 
 * may embed any number of other Nodes, at any depth within its markup.
 * 
 * Additionally, idi.bidi.dom allows the cloning of each Node and all the populated
 * instances within it (including any populated Linked Nodes that were embedded into the 
 * host's Node Prototype) This means that we could re-use the same host Node to create 
 * any number of differently populated Clones with nested Nodes, which allows us to
 * composite and nest DOM views.  
 *
 * Unlike other data-driven DOM rendering frameworks, idi.bidi.dom does not attempt 
 * to take the place of Javascript itself nor does it add its own boilerplate; it 
 * simply gives Javascript more power by offering a simple and consistent interface
 * to the DOM. 
 *
 * Usage:
 *
 * format: document.querySelector('#someNode').idom$(data [, settings])
 * 
 * output: creates a new instance of the Node using 'data' (json) to populate the 
 * special variables in the Node, then after/before to (or replace) existing 
 * instance(s) of the Node
 *
 * forClone: id of the clone the data being populated is intended for. This is omitted 
 * when operating on cloned nodes
 *
 * data: {key: value, key: value, key: value, etc} 
 * where the key must match the variable name in the data minus the idom$ prefix
 *
 * settings: {mode: 'replace'|'after'|'before'|'node'|'proto', targetInstanceName: 
 * value, instanceName: value} ... replace is default mode
 *
 * if there no populated instances of the Node then after/before/replace 
 * will create a new instance of the Node (so if a targetInstanceName is supplied 
 * in this case it will throw an error, so call .$isPopulated() first to be sure before 
 * invoking this method with targetInstanceName, unless you know the node is populated)
 * 
 * If 'mode' is set to 'node' in settings then no other settings param is expected 
 * and only the node's attributes are populated. Setting mode to 'node' will cause idom 
 * to populate only the attributes in the node itself and does not create any populated 
 * instances of its node prototype. This is useful if the instance hosts a jQuery plugin 
 * or UI widget as it will prevent the jQuery event handlers from being detached which is 
 * what happens when instances are created. Additionally, it's possible to have many node 
 * instances with jQuery UI widgets or plugins instantiated on them so idom offers a way 
 * to populate the class and style attributes of each of the node instances, by setting 
 * mode to 'proto' and specifying targetInstanceName or none for all instances. This way 
 * we don't create a new instance(s), as is the case when mode is set to any other value 
 * (other than 'node' or 'proto') -- This is both for performance and for working with node
 * instances on which jQuery plugins/widgets have been instantiated. 
 *
 * targetInstanceName: (1) idom-instance-name value for the instance of the Node to 
 * insert _at_ when in after and before modes. If null, insert after/before the last/first 
 * previously populated instance of the Node, or as the first instance if none were previously 
 * populated.
 *
 * targetInstanceName: (2) dom-instance-name value for instance(s) of the Node Protoype to 
 * replace when in replace mode. If null, replace all instances.
 *
 * instanceName: idom-instance-name value for instance of Prototype Node being populated. 
 *
 *********************************************************************************
 * 
 * Other idom methods are 
 *
 * .idom$dePopulate([settings]) which can delete certain populated instances of the Node 
 * Prototype or all populated instances 
 *
 * .idom$isPopulated() may be queried before specifying targetInstanceName to verify the 
 * existence of populated instance(s) of the node prototype (the targets) 
 * 
 * idom$clone may be used to clone an entire node (including any linked nodes) after it's 
 * been populated)
 * 
 * idom.eventHandler may be used to defined inline events, e.g. onclick=idom$someHandler 
 * and setting someHandler to idom.eventHandler(event, this, someFunction) during instance 
 * creation which binds 'this' context to the element the event was triggered on and passes
 * the event, parent node id for the instance, and the instanceName  
 * 
 * idom.baseSelector maybe used on node and instance id's to strip out the clone and any link
 * references from instanceName which is 
 *
 **********************************************************************************
 *
 * About Events:
 * 
 * If a handler is defined on the node it will only have access to the node id. If it's 
 * defined on or in the node prototype it will have access to the instance id
 *
 * The context of 'this' inside the handler function is the element the event is 
 * defined on
 *
 * Event handlers that are NOT defined using inline event handlers (like onclick, 
 * onmouseover, etc) are not handled by idom at this time. 
 *  
 * 
 *********************************************************************************/

&lt;script>
/*********************************************** PRESENTER *************************************************************/

/*************************** ALL SELECTOR DRIVEN LOGIC IS CONTAINED WITHIN THE PRESENTER ***********************************/

//cache DOM elements with idom-node-id (i.e. all node prototypes) 
idom.cache();	

(function() {
	
	for (m = 0; m &lt; jsonData.teams.length; m++) {
		
	//populate the Node Prototype of the Linked Node before the Host Node 
	 
	for (n = 0; n &lt; jsonData.teams[m].members.length; n++) {
	
		document.querySelector('[idom-node-id=userInfo]').idom$(
			{
				usersClass: 'users',
				usersProtoClass: 'usersProto',
				usersExtendedClass: 'usersExtended' ,
				borderStyle: 'none',
				displayStatus: 'none',
				bgColorUsers: rndColor(),
				bgColorUsersExtended: rndColor(),
				username: jsonData.teams[m].members[n].username,
				id: jsonData.teams[m].members[n].id,
				lastName: jsonData.teams[m].members[n].otherData.lastName,
				work: jsonData.teams[m].members[n].otherData.work,
				// we can have as many event handlers on or within a node but here we're just using the 
				// same one here, on user's first name and id 
				someHandler: 'idom.eventHandler(event, this, changeInstance)' 
				// event handler can be removed by simply setting someHandler to null
			}, 
			{
				forClone: 'clone' + Number(m + 1),
				// default mode is replace...
				mode: 'after',
				instanceName: 'user' + n
			})
		
	
	}
	
	// perform replace on the Host Node (linked node gets re/linked with each idom$() call)
	// and populate again each time before making a new clone of it

	document.querySelector('[idom-node-id=teamInfo]').idom$(
		{
			teamsClass: 'teams' + Number(m + 1),
			teamsProtoClass: 'teamsProto',
			bgColorTeams: rndColor(),
			caption: jsonData.teams[m].caption,
			instanceColorTeams: rndColor() 
		}, 
		{	
			forClone: 'clone' + Number(m + 1),
			instanceName: 'teamInfo' + Number(m + 1)
		})		

	// at this point the teamInfo div is populated with the idom$ data and the content of the linked userInfo node 
	// so we may now clone it and provide a uid for the clone (e.g. 'clone1')
	var clonedEl = document.querySelector('[idom-node-id=teamInfo]').idom$clone('clone' + Number(m + 1))

	//insert cloned node into body
	document.querySelector('#mainDiv').appendChild(clonedEl);
	
	// dePopulate() the linked node so we can restart with fresh node 
	document.querySelector('[idom-node-id=userInfo]').idom$dePopulate()
		
	// dePopulate() the host node (so we may start with no instances in the next iteration
	document.querySelector('[idom-node-id=teamInfo]').idom$dePopulate()
	
	}

}())

var toggle = {};

var Instance = {};

// the event handler is defined here on each instance of the linked node that's now inside 
// the cloned node, but it can also be defined anywhere within any node (and anywhere within any linked nodes within
// it) 

// About Events:
// If a handler is defined on the node it will only have access to the node id. If it's defined on or in the
// node prototype it will have access to the instance id

// The context of 'this' inside the handler is the element the event is defined on 

// event handlers that are not defined using inline event handlers (like onclick, onmouseover, etc) are not handled by 
// idom at this time. Finding and cloning all event handlers that are attached via different means, like jQuery, 
// will be supported in the future 

function changeInstance(event, nodeId, instanceName, cloneId) {
	
	// normally, a unique key is the combination of nodeId + instanceName + cloneId 
	// which assumes cloneId is globally unique (user enforced), node is unique within 
	// the clone (framework enforced) and instanceName is unique within the node (user enforced)
	// but in this case the nodeId contains the cloneId so we're safe...
	
	if (Instance[nodeId]) {
		
		document.querySelector('[idom-node-id="' + nodeId + '"]').idom$(
				{
					borderStyle: 'none',
					displayStatus: 'none'
				}, 
				{
					
					// when operating on a clone, we discard the forClone argument
					
				    // instanceName in settings is the same as the original populated node 
					// without link/clone references (they're added automatically)
					instanceName: idom.baseSelector(Instance[nodeId]),
					// target instance id (for instance to be replaced) 
					targetInstanceName: idom.baseSelector(Instance[nodeId])
				})
				
				toggle[Instance[nodeId]] = !toggle[Instance[nodeId]];	
				
	} 
	
	Instance[nodeId] = instanceName;
	
	toggle[Instance[nodeId]] = !toggle[Instance[nodeId]];
	
	
	if (toggle[Instance[nodeId]]) {
		
		// notice that we're only supplying the new/changed data (the delta not the whole set) for the idom$ variables 
		// in the node prototype. The idom$ variable values are persisted for each node (shared among original, linked 
		// and cloned versions of the populated node) with the key being a combination of the base node 
		// id, instance id (without the link/clone reference) and clone id 
		
		// directly accessing the linked node inside the cloned node (the linked can be nested anywhere in the
		// node prototype of the original node the clone is copied from)
		// when operating on a clone, we discard the forClone argument
		
		document.querySelector('[idom-node-id="' + nodeId + '"]').idom$(
				{
					borderStyle: borderSelector(instanceName),
					displayStatus: 'block'
				}, 
				{
					// when operating on a clone, we discard the forClone argument
					
				    // instanceName in settings is the same as the original populated node 
					// without link/clone references (they're added automatically)
					instanceName: idom.baseSelector(instanceName),
					// target instance id (for instance to be replaced) 
					targetInstanceName: idom.baseSelector(instanceName)
				})
	} else {
		
		document.querySelector('[idom-node-id="' + nodeId + '"]').idom$(
				{
					borderStyle: 'none',
					displayStatus: 'none'
				}, 
				{
					// when operating on a clone, we discard the forClone argument
					
				    // instanceName in settings is the same as the original populated node 
					// without link/clone references (they're added automatically)
					instanceName: idom.baseSelector(instanceName),
					// target instance id (for instance to be replaced) 
					targetInstanceName: idom.baseSelector(instanceName)
				})
	}
}

function button1() {
	
	// notice that we're only supplying the new/changed data (the delta not the whole set) for the idom$ variables 
	// in the node prototype. The idom$ variable values are persisted for each node (shared among original, linked 
	// and cloned versions of the populated node) with the key being a combination of the base node 
	// id, instance id (without the link/clone reference) and clone id 	
	
	// directly accessing the linked node inside the cloned node (the linked can be nested anywhere in the
	// node prototype of the original node the clone is copied from)
	// when operating on a clone, we discard the forClone argument
	
	document.querySelector('[idom-node-id="userInfo@clone@clone2"]').idom$( 
		{
			someHandler: "" //null value removes the handler
		},
		{
			// when operating on a clone, we discard the forClone argument
					
		    // instanceName in settings is the same as the original populated node 
			// without link/clone references (they're added automatically)		
			instanceName: "user1",
			targetInstanceName: "user1"
		}
	
	)
}

function button2() {
	
	// notice that we're only supplying the new/changed data (the delta not the whole set) for the idom$ variables 
	// in the node prototype. The idom$ variable values are persisted for each node (shared among original, linked 
	// and cloned versions of the populated node) with the key being a combination of the base node 
	// id, instance id (without the link/clone reference) and clone id 
	
	// directly accessing the linked node inside the cloned node (the linked can be nested anywhere in the
	// node prototype of the original node the clone is copied from)
	// when operating on a clone, we discard the forClone argument
	
	document.querySelector('[idom-node-id="userInfo@clone@clone2"]').idom$( 
		{
			someHandler: "idom.eventHandler(event, this, changeInstance)" 
		},
		{
			// when operating on a clone, we discard the forClone argument
					
			// instanceName in settings is the same as the original populated node 
			// without link/clone references (they're added automatically)instanceName: "user1",
			targetInstanceName: "user1"
		}
	
	)
}

function button3() {
	
	// notice that we're only supplying the new/changed data (the delta not the whole set) for the idom$ variables 
	// in the node prototype. The idom$ variable values are persisted for each node (shared among original, linked 
	// and cloned versions of the populated node) with the key being a combination of the base node 
	// id, instance id (without the link/clone reference) and clone id 
	
	// delete content of the cloned node (including content of the cloned linked node)
	document.querySelector('[idom-node-id="teamInfo@clone@clone3"]').idom$dePopulate()

}

function button4() {
	
	// delete content of the original Linked Node (outside the clone) 
	if (document.querySelector('[idom-node-id="userInfo"]').idom$isPopulated()) 
		document.querySelector('[idom-node-id="userInfo"]').idom$dePopulate()
		
	//Populate the Node Prototype of the original Linked Node  
	
	// notice that we're only supplying the new/changed data (the delta not the whole set) for the idom$ variables 
	// in the node prototype. The idom$ variable values are persisted for each node (shared among original, linked 
	// and cloned versions of the populated node) with the key being a combination of the base node 
	// id, instance id (without the link/clone reference) and clone id 
	
	for (n = 0; n &lt; jsonData.teams[2].members.length; n++) {
	
		document.querySelector('[idom-node-id="userInfo"]').idom$(
			{
				// data is remembered from the last time this instance (with this clone reference) was populated
				
			}, 
			{
				forClone: 'clone3',
				// default mode is replace...
				mode: 'after',
				instanceName: 'user' + n
			})
	
	}
	
	// Perform replace on the host Node inside the clone (linked node gets re/linked with each idom$() call)
	
	// notice that we're only supplying the new/changed data (the delta not the whole set) for the idom$ variables 
	// in the node prototype. The idom$ variable values are persisted for each node (shared among original, linked 
	// and cloned versions of the populated node) with the key being a combination of the base node 
	// id, instance id (without the link/clone reference) and clone id 

	// Since we're doing a replace, no need to delete content with every invocation 
	// When operating on a clone, we discard the forClone argument
	
	document.querySelector('[idom-node-id="teamInfo@clone@clone3"]').idom$(
		{
			// data is remembered from the last time this instance (with this clone reference) was populated
				
		}, 
		{   
			// when operating on a clone, we discard the forClone argument
					
		    // instanceName in settings is the same as the original populated node 
		    // without link/clone references (they're added automatically)
			instanceName: 'teamInfo3'
		})	
}

function button5() {
	
		document.querySelector('[idom-node-id="teamInfo@clone@clone4"]').idom$(
			{
			 
			 // all other data is remembered for this instance and this clone
			  cssTransform: '-webkit-transform: scale(0.5) ' + 
			  				'skew(-20deg, 20deg); ' + 
			  				'-moz-transform: scale(0.5) ' +
			  				'skew(-20deg, 20deg) ; '
				
			}, 
			{
				
			// when operating on a clone, we discard the forClone argument
			// no instanceName needed since in this mode we're only populating the node's class/stle attribute
				mode: 'node'
			}
			
		)
}

function button6() {
	
	document.querySelector('[idom-node-id="teamInfo@clone@clone4"]').idom$(
			{
			 
			 // all other data is remembered for this instance and this clone
			  cssTransform: '-webkit-transform: scale(1) ' + 
			  				'skew(0deg, 0deg); ' + 
			  				'-moz-transform: scale(1) ' +
			  				'skew(0deg, 0deg); '
				
			}, 
			{
				// when operating on a clone, we discard the forClone argument
				// no instanceName needed since in this mode we're only populating the node's class/stle attribute
				mode: 'node'
			}
			
		)
}

function borderSelector(instanceName) {
	
	var item = idom.baseSelector(instanceName)
	
	switch(item) {
		
		case 'user0':		
			return '1px dashed white';
		
		case 'user1':
			return '1px dotted white'
			
		case 'user2':
			return '1px solid white'
			
		default: 
			return '1px solid white'
	}	
}

function rndColor() {
    
    return (function(h){return '#000000'.substr(0,7-h.length)+h}) ((~~(Math.random()*(1&lt;&lt;24))).toString(16));
}

&lt;/script>


	
</pre>
</body>
</html>		


