<!DOCTYPE html>
<html>
<head>
  <meta charset='utf-8'>

  <title>idibidiart/idom @ GitHub</title>
 
 <script src='idom.js'></script>

  <!-- github styles -->
  <style type="text/css">
  	
    body {
      margin-top: 1.0em;
      font-family: Helvetica, Arial, FreeSans, san-serif;
    }
    #container {
      margin: 0 auto;
      width: 700px;
    }
    h1 { font-size: 3.8em; color: #8073ab; margin-bottom: 3px; }
    h1 .small { font-size: 0.4em; }
    h1 a { text-decoration: none }
    h2 { font-size: 1.5em; color: #8073ab; }
    h3 { text-align: center; color: #8073ab; }
    a { color: #8073ab; }
    .description { font-size: 1.2em; margin-bottom: 30px; margin-top: 30px; font-style: italic;}
    .download { float: right; }
    pre { padding-left: 15px; word-break: break; font-size: 15px}
    hr { border: 0; width: 80%; border-bottom: 1px solid #aaa}
    .footer { text-align:center; padding-top:30px; font-style: italic; }
  
  </style>
</head>

<body style='color: black; background-color: snow'>
  <a href="http://github.com/idibidiart/idi.bidi.dom"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://a248.e.akamai.net/assets.github.com/img/4c7dc970b89fd04b81c8e221ba88ff99a06c6b61/687474703a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f72696768745f77686974655f6666666666662e706e67" alt="Fork me on GitHub"></a>

  <div id="container">

    <div class="download">
      <a href="http://github.com/idibidiart/idi.bidi.dom/zipball/master">
        <img border="0" width="90" src="http://github.com/images/modules/download/zip.png"></a>
      <a href="http://github.com/idibidiart/idi.bidi.dom/tarball/master">
        <img border="0" width="90" src="http://github.com/images/modules/download/tar.png"></a>
    </div>

    <h1><a href="http://github.com/idibidiart/idi.bidi.dom">idom</a>
      <span class="small">by <a href="https://github.com/idibidiart">idibidiart</a></span></h1>

    <div class="description">
      New Way To Interact With The DOM
    </div>
</div>

<pre>

/*! idi.bidi.dom 
* 
* v0.07
*
* New Way To Interact With The DOM 
*
* Copyright (c) Marc Fawzi 2012
* 
* http://javacrypt.wordpress.com
*
* Apache License 2.0  
* 
* derived from NattyJS v0.08: a BSD licensed precursor by the same author 
*
*/
 
<br>
<img src= "idom.png";/>
<br>
/* 
 * idi.bidi.dom - Anti-Templating Framework For Javascript -- offers a radically
 * different way for interfacting with the DOM. In abstract terms, it takes the DOM 
 * and adds variables, variable memoization, encapsulation, multiple-inheritance and 
 * type polymorphism (with the Node Prototype as the user defined type) In logical 
 * terms, it offers a list-based API for creating, updating, and deleting predetermined 
 * DOM structures with the ability to link and directly access other predetermined DOM 
 * structures at any depth within them, thus giving us a simple and consistent alternative 
 * to the DOM's hierarchical API while allowing us to reduce the amount of HTML as well as 
 * separate the HTML from the presentation logic.
 *
 */
<br>
Example:
<br>
<div style='color: gray'>

&lt;!--************************************************* VIEW OBJECTS ***************************************************-->

&lt;div style='display: none'>
&lt;!-- Start of Node -->
&lt;div idom-node-id='teamInfo' class='idom$teamsClass' style='background-color: idom$bgColorTeams'>
	
	&lt;!-- Start of Node Prototype -->	
	&lt;div class='teamsProto' style='background-color: idom$instanceColorTeams;'>
		&lt;div style='padding: 5px;'>idom$caption&lt;/div>
		&lt;!-- @idom userInfo -->	 
	&lt;/div> 
	&lt;!-- End of Node Prototype -->
	
&lt;/div>
&lt;!-- End of Node -->

&lt;!-- Start of Node -->
&lt;div idom-node-id='userInfo' class='idom$usersClass' style='background-color: idom$bgColorUsers'>
	
	&lt;!-- Start of Node Prototype -->
	&lt;div class='usersProto' style='border: idom$itemColor;'> 
		
		&lt;div onclick='idom$someHandler'>idom$username&nbsp;&nbsp;&nbsp;idom$id&lt;/div>
				
	&lt;/div>
	&lt;!-- End of Node Prototype -->
	
&lt;/div>
&lt;!-- End of Node -->
&lt;/div>

</div>
</pre>

<div id='mainDiv' style='height: 600px'>
<div>

<p>Click on any user below to see the idom-attached event handler for the target element in action</p>

<button onclick='button1()'>Click to disable event handling on 2nd user in clone 2</button>
<button onclick='button2()'>Click to enable event handling on 2nd user in clone 2</button>
<br><br>
<button onclick='button3()'>Click to delete content of clone 3</button>
<button onclick='button4()'>Click to re-populate clone 3</button>

<br>
<br>
randomly colored
<br>
<br>

</div>
	
</div>



<!--************************************************* INTERFACE OBJECT ***********************************************-->
<script type="text/javascript" src="jsonData.js"></script>

<!--************************************************* VIEW OBJECTS ***************************************************-->
<style>
.teams {
	float: left; 
	width: auto; 
	height: auto;
	margin: 10px;
	padding: 0px;
}

.teamsProto {
	
	padding: 20px; 
	border-radius: 10px;
	margin: 10px;
	height: 400px; 
	width: 60%;
}

.users {
	border-radius: 10px;
	height: 300px;
	width: 240px;
	padding: 10px;
}

.usersProto {
	
box-sizing: border-box ; 
margin: 2px; 
border-radius: 
5px;padding: 5px;'
}
</style>

<div style='display: none'>
<!-- Start of Node -->
<div idom-node-id='teamInfo' class='idom$teamsClass' style='background-color: idom$bgColorTeams'>
	
	<!-- Start of Node Prototype -->	
	<div class='teamsProto' style='background-color: idom$instanceColorTeams;'>
		<div style='padding: 5px;'>idom$caption</div>
		<!-- @idom userInfo -->	 
	</div> 
	<!-- End of Node Prototype -->
	
</div>
<!-- End of Node -->

<!-- Start of Node -->
<div idom-node-id='userInfo' class='idom$usersClass' style='background-color: idom$bgColorUsers'>
	
	<!-- Start of Node Prototype -->
	<div class='usersProto' style='border: idom$itemColor;'> 
		
		<div onclick='idom$someHandler'>idom$username&nbsp;&nbsp;&nbsp;idom$id</div>
				
	</div>
	<!-- End of Node Prototype -->
	
</div>
<!-- End of Node -->
</div>

<br>
<div style='width: 1024px; overflow: hidden'>
<pre>
&lt;script>
/*********************************************** PRESENTER *************************************************************/

//cache DOM elements with idom-node-id (i.e. all node prototypes) and supply values for init() variables (i$var) if any (as simple JSON)
idom.init();	

for (m = 0; m &lt; jsonData.teams.length; m++) {
		
	//populate the Node Prototype of the Linked Node first  
	//and populate again each time before making a new clone that links it 
	for (n = 0; n &lt; jsonData.teams[m].members.length; n++) {
	
		document.querySelector('[idom-node-id=userInfo]').idom$('clone' + Number(m + 1),
			{
				usersClass: 'users',
				bgColorUsers: rndColor(),
				username: jsonData.teams[m].members[n].username,
				id: jsonData.teams[m].members[n].id,
				// we can have as many event handlers on or within a node but here we're just using the 
				//same one on two elements 
				someHandler: 'idom.eventHandler(event, this, changeColor)' 
				// event handler can be removed by simply setting someHandler to null
			}, 
			{
				mode: 'append',
				instanceId: 'user' + n
			})
	
	}
	
	// perform replace on the host Node (linked node gets re/linked with each idom$() call)
	// and populate again each time before making a new clone of it
	document.querySelector('[idom-node-id=teamInfo]').idom$('clone' + Number(m + 1),
		{
			teamsClass: 'teams',
			bgColorTeams: rndColor(),
			caption: jsonData.teams[m].caption,
			instanceColorTeams: rndColor() 
		}, 
		{	
			mode: 'replace',
			instanceId: 'team' + Number(m + 1)
		})		

	// at this point the teamInfo div is populated with the 'caption' data and the content of the linked userInfo node 
	// so we may now clone it and provide a uid for the clone (e.g. 'clone1')
	var clonedEl = document.querySelector('[idom-node-id=teamInfo]').idom$clone('clone' + Number(m + 1))

	//insert cloned node into body
	document.querySelector('#mainDiv').appendChild(clonedEl);
	
	// normally, we'd delete the contents of the host node (so we're startig with no instances in the next iteration) but 
	// in this case the host node's node prototype instance is being replaced each time (mode: 'replace') 
	// so no need to delete it
	
	// now that we have everything in the cloned node, delete the external linked node's content so we're startig with 
	// no instances in the next iteration)
	document.querySelector('[idom-node-id=userInfo]').idom$dePopulate()

}

var toggleColor = {};

// the event handler is defined here on each instance of the linked node that's now inside 
// the cloned node, but it can also be defined anywhere within any node (and anywhere within any linked nodes within
// it) 

// About Events:
// If the handler is defined on the node it will only have access to the node id. If it's defined on or in the
// node prototype it will have access to the instance id

// The context of 'this' inside the handler becomes the element the event is defined on (i.e. the cloned node
// or the node prototype instance within it), which is the normal way 'this' is handled in this context

// event handlers that are not defined using element attributes (e.g. onclick, onmouseover, etc) are not handled
// by idom at this time. Finding and cloning all event handlers that are attached via different means, like jQuery, 
// will be supported in the future 

function changeColor(event, nodeId, instanceId) {
	
	event.preventDefault();
    
	toggleColor[instanceId] = !toggleColor[instanceId];
	
	if (toggleColor[instanceId]) {
		
		// notice that we're only supplying the new/changed data (the delta not the whole set) for the idom$ variables 
		// in the node prototype. The idom$ variable values are persisted for each node (shared among original, linked 
		// and cloned versions of the node, but not the branched nodes) with the key being a combination of the base node 
		// id, instance id, and clone id 
		
		// directly accessing the linked node inside the cloned node (the linked can be nested anywhere in the
		// node prototype of the original node the clone is copied from)
		// when operating on a clone, we discard the cloneId argument

		document.querySelector('[idom-node-id="' + nodeId + '"]').idom$(
				{
					itemColor: colorSelector(instanceId)
				}, 
				{
					// instanceId in settings is the same as the original populated node 
					// without link/clone references (they're added automatically)
					
				
					instanceId: idom.baseSelector(instanceId), 
					mode: 'replace', 
					targetInstanceId: idom.baseSelector(instanceId)
				})
	} else {
		
		document.querySelector('[idom-node-id="' + nodeId + '"]').idom$(
				{
					itemColor: 'transparent'
				}, 
				{
					// instanceId in settings is the same as the original populated node 
					// without link/clone references (they're added automatically)
					
					instanceId: idom.baseSelector(instanceId), 
					mode: 'replace', 
					targetInstanceId: idom.baseSelector(instanceId)
				})
	}

}

function button1() {
	
	// notice that we're only supplying the new/changed data (the delta not the whole set) for the idom$ variables 
	// in the node prototype. The idom$ variable values are persisted for each node (shared among original, linked 
	// and cloned versions of the node, but not the branched nodes) with the key being a combination of the base node 
	// id, instance id, and clone id 	
	
	// directly accessing the linked node inside the cloned node (the linked can be nested anywhere in the
	// node prototype of the original node the clone is copied from)
	// when operating on a clone, we discard the cloneId argument
	
	document.querySelector('[idom-node-id="userInfo@linked@team2@cloned@clone2"]').idom$( 
		{
			someHandler: "" //null value removes the handler
		},
		{
			// instanceId in settings is the same as the original populated node 
			// without link/clone references (they're added automatically)
					
			instanceId: "user1",
			mode: "replace",
			targetInstanceId: "user1"
		}
	
	)
}

function button2() {
	
	// notice that we're only supplying the new/changed data (the delta not the whole set) for the idom$ variables 
	// in the node prototype. The idom$ variable values are persisted for each node (shared among original, linked 
	// and cloned versions of the node, but not the branched nodes) with the key being a combination of the base node 
	// id, instance id, and clone id 
	
	// directly accessing the linked node inside the cloned node (the linked can be nested anywhere in the
	// node prototype of the original node the clone is copied from)
	// when operating on a clone, we discard the cloneId argument
	
	document.querySelector('[idom-node-id="userInfo@linked@team2@cloned@clone2"]').idom$( 
		{
			someHandler: "idom.eventHandler(event, this, changeColor)" 
		},
		{
			// instanceId in settings is the same as the original populated node 
			// without link/clone references (they're added automatically)
					
			instanceId: "user1",
			mode: "replace",
			targetInstanceId: "user1"
		}
	
	)
}

function button3() {
	
	// notice that we're only supplying the new/changed data (the delta not the whole set) for the idom$ variables 
	// in the node prototype. The idom$ variable values are persisted for each node (shared among original, linked 
	// and cloned versions of the node, but not the branched nodes) with the key being a combination of the base node 
	// id, instance id, and clone id 
	
	// delete content of the cloned node (including content of the cloned linked node)
	document.querySelector('[idom-node-id="teamInfo@cloned@clone3"]').idom$dePopulate()

}

function button4() {
	
	// delete content of the original Linked Node (outside the clone) 
	if (document.querySelector('[idom-node-id="userInfo"]').idom$isPopulated()) 
		document.querySelector('[idom-node-id="userInfo"]').idom$dePopulate()
		
	//First, populate the Node Prototype of the original Linked Node (outside the clone) 
	
	// notice that we're only supplying the new/changed data (the delta not the whole set) for the idom$ variables 
	// in the node prototype. The idom$ variable values are persisted for each node (shared among original, linked 
	// and cloned versions of the node, but not the branched nodes) with the key being a combination of the base node 
	// id, instance id, and clone id 
	
	for (n = 0; n &lt; jsonData.teams[2].members.length; n++) {
	
		document.querySelector('[idom-node-id="userInfo"]').idom$('clone3',
			{
				// data is remembered from the last time this instance (with this clone reference) was populated
				
			}, 
			{
				mode: 'append',
				instanceId: 'user' + n
			})
	
	}
	
	// Perform replace on the host Node inside the clone (linked node gets re/linked with each idom$() call)
	// Clone and link references are automatically added to the Node and the Linked Node and all their instances
	
	// notice that we're only supplying the new/changed data (the delta not the whole set) for the idom$ variables 
	// in the node prototype. The idom$ variable values are persisted for each node (shared among original, linked 
	// and cloned versions of the node, but not the branched nodes) with the key being a combination of the base node 
	// id, instance id, and clone id 

	// Since we're doing a replace, no need to delete content with every invocation 
	// When operating on a clone, we discard the cloneId argument
	
	document.querySelector('[idom-node-id="teamInfo@cloned@clone3"]').idom$(
		{
			// data is remembered from the last time this instance (with this clone reference) was populated
				
		}, 
		{
			mode: 'replace',
			instanceId: 'team3'
		})	
		
	
}


function colorSelector(instanceId) {
	
	var item = idom.baseSelector(instanceId)
	
	switch(item) {
		
	case 'user0': 
			
		return '1px dashed white';
	
	case 'user1':
		
		return '1px dotted white'
		
	case 'user2':
		
		return '1px solid white'
		
	default: return '1px solid white'
	
	}	
}

function rndColor() {
    return '#' + ('00000' + (Math.random() * 16777216 &lt;&lt; 0).toString(16)).substr(-6);
}

&lt;/script>
</pre>	
</div>

<script>
/*********************************************** PRESENTER *************************************************************/

//cache DOM elements with idom-node-id (i.e. all node prototypes) and supply values for init() variables (i$var) if any (as simple JSON)
idom.init();	

for (m = 0; m < jsonData.teams.length; m++) {
		
	//populate the Node Prototype of the Linked Node first  
	//and populate again each time before making a new clone that links it 
	for (n = 0; n < jsonData.teams[m].members.length; n++) {
	
		document.querySelector('[idom-node-id=userInfo]').idom$('clone' + Number(m + 1),
			{
				usersClass: 'users',
				bgColorUsers: rndColor(),
				username: jsonData.teams[m].members[n].username,
				id: jsonData.teams[m].members[n].id,
				// we can have as many event handlers on or within a node but here we're just using the 
				//same one on two elements 
				someHandler: 'idom.eventHandler(event, this, changeColor)' 
				// event handler can be removed by simply setting someHandler to null
			}, 
			{
				mode: 'append',
				instanceId: 'user' + n
			})
	
	}
	
	// perform replace on the host Node (linked node gets re/linked with each idom$() call)
	// and populate again each time before making a new clone of it
	document.querySelector('[idom-node-id=teamInfo]').idom$('clone' + Number(m + 1),
		{
			teamsClass: 'teams',
			bgColorTeams: rndColor(),
			caption: jsonData.teams[m].caption,
			instanceColorTeams: rndColor() 
		}, 
		{	
			mode: 'replace',
			instanceId: 'team' + Number(m + 1)
		})		

	// at this point the teamInfo div is populated with the 'caption' data and the content of the linked userInfo node 
	// so we may now clone it and provide a uid for the clone (e.g. 'clone1')
	var clonedEl = document.querySelector('[idom-node-id=teamInfo]').idom$clone('clone' + Number(m + 1))

	//insert cloned node into body
	document.querySelector('#mainDiv').appendChild(clonedEl);
	
	// normally, we'd delete the contents of the host node (so we're startig with no instances in the next iteration) but 
	// in this case the host node's node prototype instance is being replaced each time (mode: 'replace') 
	// so no need to delete it
	
	// now that we have everything in the cloned node, delete the external linked node's content so we're startig with 
	// no instances in the next iteration)
	document.querySelector('[idom-node-id=userInfo]').idom$dePopulate()

}

var toggleColor = {};

// the event handler is defined here on each instance of the linked node that's now inside 
// the cloned node, but it can also be defined anywhere within any node (and anywhere within any linked nodes within
// it) 

// About Events:
// If the handler is defined on the node it will only have access to the node id. If it's defined on or in the
// node prototype it will have access to the instance id

// The context of 'this' inside the handler becomes the element the event is defined on (i.e. the cloned node
// or the node prototype instance within it), which is the normal way 'this' is handled in this context

// event handlers that are not defined using element attributes (e.g. onclick, onmouseover, etc) are not handled
// by idom at this time. Finding and cloning all event handlers that are attached via different means, like jQuery, 
// will be supported in the future 

function changeColor(event, nodeId, instanceId) {
	
	event.preventDefault();
    
	toggleColor[instanceId] = !toggleColor[instanceId];
	
	if (toggleColor[instanceId]) {
		
		// notice that we're only supplying the new/changed data (the delta not the whole set) for the idom$ variables 
		// in the node prototype. The idom$ variable values are persisted for each node (shared among original, linked 
		// and cloned versions of the node, but not the branched nodes) with the key being a combination of the base node 
		// id, instance id, and clone id 
		
		// directly accessing the linked node inside the cloned node (the linked can be nested anywhere in the
		// node prototype of the original node the clone is copied from)
		// when operating on a clone, we discard the cloneId argument

		document.querySelector('[idom-node-id="' + nodeId + '"]').idom$(
				{
					itemColor: colorSelector(instanceId)
				}, 
				{
					// instanceId in settings is the same as the original populated node 
					// without link/clone references (they're added automatically)
					
				
					instanceId: idom.baseSelector(instanceId), 
					mode: 'replace', 
					targetInstanceId: idom.baseSelector(instanceId)
				})
	} else {
		
		document.querySelector('[idom-node-id="' + nodeId + '"]').idom$(
				{
					itemColor: 'transparent'
				}, 
				{
					// instanceId in settings is the same as the original populated node 
					// without link/clone references (they're added automatically)
					
					instanceId: idom.baseSelector(instanceId), 
					mode: 'replace', 
					targetInstanceId: idom.baseSelector(instanceId)
				})
	}

}

function button1() {
	
	// notice that we're only supplying the new/changed data (the delta not the whole set) for the idom$ variables 
	// in the node prototype. The idom$ variable values are persisted for each node (shared among original, linked 
	// and cloned versions of the node, but not the branched nodes) with the key being a combination of the base node 
	// id, instance id, and clone id 	
	
	// directly accessing the linked node inside the cloned node (the linked can be nested anywhere in the
	// node prototype of the original node the clone is copied from)
	// when operating on a clone, we discard the cloneId argument
	
	document.querySelector('[idom-node-id="userInfo@linked@team2@cloned@clone2"]').idom$( 
		{
			someHandler: "" //null value removes the handler
		},
		{
			// instanceId in settings is the same as the original populated node 
			// without link/clone references (they're added automatically)
					
			instanceId: "user1",
			mode: "replace",
			targetInstanceId: "user1"
		}
	
	)
}

function button2() {
	
	// notice that we're only supplying the new/changed data (the delta not the whole set) for the idom$ variables 
	// in the node prototype. The idom$ variable values are persisted for each node (shared among original, linked 
	// and cloned versions of the node, but not the branched nodes) with the key being a combination of the base node 
	// id, instance id, and clone id 
	
	// directly accessing the linked node inside the cloned node (the linked can be nested anywhere in the
	// node prototype of the original node the clone is copied from)
	// when operating on a clone, we discard the cloneId argument
	
	document.querySelector('[idom-node-id="userInfo@linked@team2@cloned@clone2"]').idom$( 
		{
			someHandler: "idom.eventHandler(event, this, changeColor)" 
		},
		{
			// instanceId in settings is the same as the original populated node 
			// without link/clone references (they're added automatically)
					
			instanceId: "user1",
			mode: "replace",
			targetInstanceId: "user1"
		}
	
	)
}

function button3() {
	
	// notice that we're only supplying the new/changed data (the delta not the whole set) for the idom$ variables 
	// in the node prototype. The idom$ variable values are persisted for each node (shared among original, linked 
	// and cloned versions of the node, but not the branched nodes) with the key being a combination of the base node 
	// id, instance id, and clone id 
	
	// delete content of the cloned node (including content of the cloned linked node)
	document.querySelector('[idom-node-id="teamInfo@cloned@clone3"]').idom$dePopulate()

}

function button4() {
	
	// delete content of the original Linked Node (outside the clone) 
	if (document.querySelector('[idom-node-id="userInfo"]').idom$isPopulated()) 
		document.querySelector('[idom-node-id="userInfo"]').idom$dePopulate()
		
	//First, populate the Node Prototype of the original Linked Node (outside the clone) 
	
	// notice that we're only supplying the new/changed data (the delta not the whole set) for the idom$ variables 
	// in the node prototype. The idom$ variable values are persisted for each node (shared among original, linked 
	// and cloned versions of the node, but not the branched nodes) with the key being a combination of the base node 
	// id, instance id, and clone id 
	
	for (n = 0; n < jsonData.teams[2].members.length; n++) {
	
		document.querySelector('[idom-node-id="userInfo"]').idom$('clone3',
			{
				// data is remembered from the last time this instance (with this clone reference) was populated
				
			}, 
			{
				mode: 'append',
				instanceId: 'user' + n
			})
	
	}
	
	// Perform replace on the host Node inside the clone (linked node gets re/linked with each idom$() call)
	// Clone and link references are automatically added to the Node and the Linked Node and all their instances
	
	// notice that we're only supplying the new/changed data (the delta not the whole set) for the idom$ variables 
	// in the node prototype. The idom$ variable values are persisted for each node (shared among original, linked 
	// and cloned versions of the node, but not the branched nodes) with the key being a combination of the base node 
	// id, instance id, and clone id 

	// Since we're doing a replace, no need to delete content with every invocation 
	// When operating on a clone, we discard the cloneId argument
	
	document.querySelector('[idom-node-id="teamInfo@cloned@clone3"]').idom$(
		{
			// data is remembered from the last time this instance (with this clone reference) was populated
				
		}, 
		{
			mode: 'replace',
			instanceId: 'team3'
		})	
		
	
}


function colorSelector(instanceId) {
	
	var item = idom.baseSelector(instanceId)
	
	switch(item) {
		
	case 'user0': 
			
		return '1px dashed white';
	
	case 'user1':
		
		return '1px dotted white'
		
	case 'user2':
		
		return '1px solid white'
		
	default: return '1px solid white'
	
	}	
}

function rndColor() {
    return '#' + ('00000' + (Math.random() * 16777216 << 0).toString(16)).substr(-6);
}

</script>


<pre>



	
</pre>
</body>
</html>		


